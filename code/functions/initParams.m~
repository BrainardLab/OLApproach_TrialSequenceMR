function params = initParams(exp)
% initParams - Loads config file to get the params struct.
%
% Usage:
%     params = initParams(exp)
%
% Description:
%     Loads a config file which contains information about the experimental
%     paradigm. I DONT THINK WE NEED THIS. THIS SHOUL
%     
% Input:
%     exp - A struct that contain the starts/stops. Optional attentional 
%                      task is set by protocolParams.attentionTask = true. 
%
% Output:
%     block - Stuct containing starts/stops with optional attention trials. 
%
% Optional key/value pairs.
%    None.
%
% See also:

% IT MIGHT BE BETTER TO HAVE THIS FUNCTION JUST HANDLE ADDING THE ATTENTION
% TASK AND REMOVE OTHER STUFF. --mb 

% 8/2/17  mab  Split from experiment and tried to add comments.
% params = initParams(exp)
% Initialize the parameters

% Much with the paths a little bit.
[~, tmp, suff] = fileparts(exp.configFileName);
exp.configFileName = fullfile(exp.configFileDir, [tmp, suff]);

% Load the config file for this condition.
cfgFile = ConfigFile(exp.configFileName);

% Convert all the ConfigFile parameters into simple struct values.
params = convertToStruct(cfgFile);
params.cacheDir = fullfile(exp.baseDir, 'cache');

% Load the calibration file.
cType = OLCalibrationTypes.(params.calibrationType);
params.oneLightCal = LoadCalFile(cType.CalFileName);

% Setup the cache.
params.obsID = exp.subject;
file_names = allwords(params.modulationFiles,',');
for i = 1:length(file_names)
    % Create the cache file name.
    params.cacheFileName{i} = file_names{i};
end

end